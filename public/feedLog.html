<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitter CJR - Feed logado</title>
    <link rel="stylesheet" href=".\css\feedDeslog.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<script>
    document.addEventListener('DOMContentLoaded', async function() {
        const token = localStorage.getItem('token');

        if (token) {
            try {
                const response = await axios.get('/users/me', {
                    headers: {
                        Authorization: `Bearer ${token}`
                    }
                });

                const userData = response.data; 

                const profileLink = document.querySelector('.perfil a');
                profileLink.textContent = userData.username; 
                profileLink.href = '/perfil-logado'; 
                const profileImage = document.querySelector('.perfil img');
                
            } catch (error) {
                console.error('Erro ao buscar informações do usuário:', error);
            }
        }
    });
</script>

<body>
    <nav>
        <img class="logo_cjr" src=".\images\Logo_CJR_Estilizado.png" alt="Logo estilizado CJR">

        <div style="flex-grow: 1;"></div>

        <div class="perfil">

            <a herf="perfil"><button
                    style="background: #6ADAFF;border-radius: 16px; padding: 12px; cursor: pointer; color:#ffff; border: none; font-size: 16px;">Joazin
                    Gamer</button> </a>
            <img class="perfilpost" src=".\images\FotoPerfil1.png" alt="Imagem de perfil" herf="perfil">
        </div>
        <div class="espaco"> </div>
        <div class="logout">
            <img class="Logout" src=".\images\log-out.png" alt="Imagem de Logout" herf="feed.html">

        </div>

    </nav>


    <main class="coluna">
        <section class="Publicacoes">
            <div class="section">
                <div class="inlineLog">
                    <p class="divpublicacao" style="color: #FFFFFF;"><strong>Publicações</strong></p>
                    <div style="flex-grow: 1;"></div>
                    <a href="postar">
                        <button style="background: #6ADAFF; border-radius: 16px; padding: 0.5em; cursor: pointer; color: #ffff; border: none; font-size: 16px; margin-top: 10px;">Criar Post</button>
                    </a>
                </div>
                

                <hr size="3" width="100%" color="#FFFFFF">

                <div class="twittes">
                    <div class="inline">
                        <img class="perfilpost" src=".\images\FotoPerfil1.png" alt="Imagem de perfil">
                        <div class="nome_data">
                            <a href="perfil">
                                <button style="background:#6ADAFF; border-radius: 16px; padding: 12px; cursor: pointer; color:#FFFF; border: none; font-size: 16px;">Joazin Gamer</button>
                            </a>
                            <p class="data">22/10/2023</p>
                        </div>
                    </div>
                    <div class="escrito">
                        <p class="escrito_" style="color: #FFFFFF;">Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin</p>
                    </div>
                    <div class="comentarioEditar" style="background:#6ADAFF; padding: 10px; border-radius: 16px; margin-top: 10px;">
                        <img class="comentario" src="./images/Comentario.png" alt="Imagem Comentario" href="comentar">
                        <img class="editar" src=".\images\editar_post.png" alt="Imagem editar" href="editar">
                        <img class="Apagar" src=".\images\Lixo.png" alt="Imagem do Lixo" href="apagar">
                    </div>
                </div>
                
                <div class="espaco"> </div>

                
        </section>
    </main>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function () {
carregarPosts();
});

async function carregarPosts() {
try {
    const response = await fetch('http://localhost:3000/post'); // Substitua pela sua URL de endpoint
    const posts = await response.json();
    console.log(posts)

    const postList = document.getElementById('postList');
    postList.innerHTML = '';

    posts.forEach(post => {
        const listItem = document.createElement('li');
        listItem.textContent = post.content;

        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'Excluir';
        deleteButton.onclick = () => excluirPost(post.id);

        listItem.appendChild(deleteButton);
        postList.appendChild(listItem);
    });
} catch (error) {
    console.error('Erro ao carregar posts:', error);
}
}

async function criarPost() {
const postContent = document.getElementById('postContent').value;

try {
    await fetch('http://localhost:3000/createPost', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ content: postContent }),
    });

    carregarPosts(); // Recarrega a lista após criar o post
} catch (error) {
    console.error('Erro ao criar post:', error);
}
}

async function excluirPost(postId) {
try {
    await fetch(`http://localhost:3000/deletePost/${postId}`, {
        method: 'DELETE',
    });

    carregarPosts(); // Recarrega a lista após excluir o post
} catch (error) {
    console.error('Erro ao excluir post:', error);
}
}
document.getElementById('signupForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const username = document.getElementById('name').value;
            
           
        
            const userData = {
                username,
                content,
            };

            try {
                const response = await fetch('http://localhost:3000/users/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });

                const data = await response.json();

                if (response.ok) {
                    alert('Cadastro concluído com sucesso!');
                    window.location.href = '/login-page';
                } else {
                    alert(data.error); 
                }

            } catch (error) {
                console.error('Erro ao cadastrar usuário:', error);
                alert('Erro ao cadastrar usuário!');
            }
        });
   


</script>
</html>
