<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitter CJR - Feed logado</title>
    <link rel="stylesheet" href=".\css\feedDeslog.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<script>
    document.addEventListener('DOMContentLoaded', async function() {
        const token = localStorage.getItem('token');

        if (token) {
            try {
                const response = await axios.get('/users/me', {
                    headers: {
                        Authorization: `Bearer ${token}`
                    }
                });

                const userData = response.data; 

                // exibição das informações do usuário no header
                const profileLink = document.querySelector('.perfil a');
                profileLink.textContent = userData.username; 
                profileLink.href = '/perfil-logado'; // link para o perfil do usuário
 
            } catch (error) {
                console.error('Erro ao buscar informações do usuário:', error);
            }
        }
    });
</script>

<body>
    <nav>
        <img class="logo_cjr" src=".\images\Logo_CJR_Estilizado.png" alt="Logo estilizado CJR">
        <div style="flex-grow: 1;"></div>
        <div class="perfil">
            <a href="/perfil-logado" style="background: #6ADAFF; border-radius: 16px; padding: 12px; cursor: pointer; color:#ffff; border: none; font-size: 17px; text-decoration: none;"></a>
            <img class="perfilpost" src=".\images\FotoPerfil1.png" alt="Imagem de perfil" href="perfil">
        </div>
        <div class="espaco"> </div>
        <div class="logout">
            <img class="Logout" src=".\images\log-out.png" alt="Imagem de Logout" href="feed.html">
        </div>
    </nav>


    <main class="coluna">
        <section class="Publicacoes">
            <div class="section">
                <div class="inlineLog">
                    <p class="divpublicacao" style="color: #FFFFFF;"><strong>Publicações</strong></p>
                    <div style="flex-grow: 1;"></div>
                    <a href="postar">
                        <button style="background: #6ADAFF; border-radius: 16px; padding: 0.5em; cursor: pointer; color: #ffff; border: none; font-size: 16px; margin-top: 10px;">Criar Post</button>
                    </a>
                </div>
                

                <hr size="3" width="100%" color="#FFFFFF" style=" margin-bottom: 2rem;">

                <ul id="postList"></ul>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            carregarPosts();
        });

        async function carregarPosts() {
            try {
                const response = await fetch('http://localhost:3000/post'); 
                const posts = await response.json();

                const postList = document.getElementById('postList');
                postList.innerHTML = '';

                posts.forEach(post => {
                    const listItem = document.createElement('li');
                    listItem.classList.add('twittes'); // "twittes" 

                    const userProfile = document.createElement('div');
                    userProfile.classList.add('inline');

                    const profileImage = document.createElement('img');
                    profileImage.classList.add('perfilpost');
                    profileImage.src = "./images/FotoPerfil1.png"
                    profileImage.alt = 'Imagem de perfil';
                    profileImage.href = `/perfil-logado`; // Adiciona o link para o perfil do usuário

                    

                    const nameDate = document.createElement('div');
                    nameDate.classList.add('nome_data');

                    const userNameLink = document.createElement('a');
                    userNameLink.href = '/perfil-logado'; //  link do perfil do usuário

                    const postDate = document.createElement('p');
                    postDate.classList.add('data');
                    postDate.textContent = post.date; // 
                    
                    nameDate.appendChild(userNameLink);
                    nameDate.appendChild(postDate);
                    userProfile.appendChild(profileImage);
                    userProfile.appendChild(nameDate);

                    const content = document.createElement('div');
                    content.classList.add('escrito');

                    const contentParagraph = document.createElement('p');
                    contentParagraph.classList.add('escrito_');
                    contentParagraph.style.color = '#FFFFFF';
                    contentParagraph.textContent = post.content; 

                    const actions = document.createElement('div');
                    actions.classList.add('comentarioEditar'); 

                    const commentImage = document.createElement('img');
                    commentImage.classList.add('comentario');
                    commentImage.src = './images/Comentario.png'; 
                    commentImage.alt = 'Imagem Comentario';
                    commentImage.href = 'comentar'; 

                    const editImage = document.createElement('img');
                    editImage.classList.add('editar');
                    editImage.src = './images/editar_post.png'; 
                    editImage.alt = 'Imagem editar';
                    editImage.href = 'editar'; 

                    const deleteImage = document.createElement('img');
                    deleteImage.classList.add('Apagar');
                    deleteImage.src = './images/Lixo.png'; 
                    deleteImage.alt = 'Imagem do Lixo';
                    deleteImage.href = 'apagar'; 

                    

                    actions.appendChild(commentImage);
                    actions.appendChild(editImage);
                    actions.appendChild(deleteImage);

                    content.appendChild(contentParagraph);

                    listItem.appendChild(userProfile);
                    listItem.appendChild(content);
                    listItem.appendChild(actions);

                    postList.appendChild(listItem);

                    
                });
            } catch (error) {
                console.error('Erro ao carregar posts:', error);
            }
        }
    </script>
</body>

</html>
